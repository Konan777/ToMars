1) Откуда идут данные в документ?
2) v_eqp используется только в одном месте?
3) какая дата в sample является датой анализа?

В случае если из v_eqp:
При выборе дат проверки оборудования нам неизвестен образец и его дата
1) переписать v_eqp чтобы на вход подавались SampleTechTestEqp.SampleTechTestUid
  потом идти на SampleTechTestEqp->SampleTechTest->SampleTech->Sample за датой образца
  потом идти в EqpCheckLog и сворачивать выборку  [NextDate], [Doc], [DocDate]
2) пишем табличную функицю которая для набора SampleTechTestUid которая вернет три поля
  затем апдейтить поля в нужной таблице в приложении


use [I-LDS_2]
go
drop function [dbo].[fun_test_tabl]  
go
CREATE FUNCTION [dbo].[fun_test_tabl]  
(	
	@date datetime
)
RETURNS TABLE 
AS
RETURN 
(
	SELECT * from v_Eqp where DocDate>=@date
)
GO

LEFT JOIN (
	SELECT [ca].* FROM (
		SELECT EqpUid, MIN(NextDate) AS nextdate FROM [dbo].[EqpCheckLog]
		WHERE NextDate > GETDATE()
		GROUP BY EqpUid) AS [MaxDates]
		CROSS APPLY (
			SELECT TOP 1 * FROM [dbo].[EqpCheckLog]
			WHERE dbo.EqpCheckLog.EqpUid = [MaxDates].EqpUid
			AND EqpCheckLog.NextDate = [MaxDates].nextdate
		) AS [ca]
) AS [CheckLog]ON [CheckLog].[EqpUid] = [dbo].[Eqp].EqpUid


-- Проверяем что вернет новый скрипт для тестового случая
select EqpUid, Doc, 
CONVERT(varchar,DocDate  ,104)+' '+CONVERT(varchar,DocDate  ,108) as DocDate,
CONVERT(varchar,NextDate  ,104)+' '+CONVERT(varchar,NextDate  ,108) as NextDate,
CONVERT(varchar,CreationDate  ,104)+' '+CONVERT(varchar,CreationDate  ,108) as CreationDate,
SampleId from [dbo].[v_Eqp_by_sample](cast('3DCB89D1-DCE9-4EF8-8CCE-820C5C53FB15' as uniqueidentifier)) z_Eqp

LEFT JOIN (
	-- Найдем действующую на дату образца запись в журнале проверок оборудования
	select distinct ECL.*, SDT.SampleId, SDT.CreationDate
	from [dbo].[SampleTechTestEqp] STTE
	inner join [dbo].[Eqp] EPQ on EPQ.[EqpUid]=STTE.EqpUid
	inner join [dbo].[EqpCheckLog] ECL on ECL.EqpUid=EPQ.EqpUid
	inner join [dbo].[EqpCheck] EC on EC.[EqpCheckUid]=ECL.[EqpCheckUid]
	inner join (
		-- Найдем дату образца
		select distinct STTE.SampleTechTestUid, SM.CreationDate, SM.SampleId
		from [dbo].[SampleTechTestEqp] STTE
		inner join [dbo].[SampleTechTest] STT on STT.SampleTechTestId=STTE.SampleTechTestUid
		inner join [dbo].[SampleTech] ST on ST.SampleTechId=STT.SampleTechId
		inner join [dbo].[Sample] SM on SM.SampleId=ST.SampleId
		where STTE.SampleTechTestUid = @sampleTechTestUid
			--in (SELECT [uid] FROM  @sampleTechTestUid)
	) as SDT on SDT.SampleTechTestUid=STTE.SampleTechTestUid
	where STTE.SampleTechTestUid = @sampleTechTestUid
		--in (SELECT [uid] FROM  @sampleTechTestUid)
	and SDT.CreationDate>=ECL.DocDate
	and SDT.CreationDate<=ECL.NextDate
) AS [CheckLog] ON [CheckLog].[EqpUid] = [dbo].[Eqp].EqpUid 




