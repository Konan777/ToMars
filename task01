Задания->1. Задания->Продукт, правый клик -> Печать->Образцы->Этикетка

SampleTech 		- Методика образца
SampleTechTest 	- Показатель образца
TestResult		- Результат измерений показателя
TestResultAnalog- Измерение аналогового показателя
TestResultHistory История изменения рузультата измерений показателя образца
TestResultHistoryComment Комментарий к записи истории изменения рузльтат измерений показателя

[TestResult]->[TestResultHistory]->[TestResultHistoryComment]=Результат измерений показателя+История изменения+Коммент
[TestResult]->[SampleTechTest]->[SampleTech]=Результат измерений показателя+Показатель образца+Методика образца


Нужно создать или найти задание на тестирование показателя образца
Затем сделать для образца этикетку
Посмотреть ее на печати
Добавить новое поле
Добавить данные в таблицу
Снова вызвать печать этикетки

select tr.TestResultId, stt.SampleTechTestId, st.SampleTechId, s.*
from [TestResult] tr
inner join [SampleTechTest] stt on stt.SampleTechTestId=tr.SampleTechTestId
inner join [SampleTech] st on st.SampleTechId=stt.SampleTechId
inner join [Sample] s on s.SampleId=st.SampleId
where TestResultId='6237A3F0-B30B-4E71-A1E4-0001994AFFAD'

	select distinct mix.[TestResultId]
	,FIRST_VALUE(mix.[Comment]) OVER (PARTITION BY mix.[TestResultId] order by mix.[ChangeDate] desc) as [Comment]
	from (
		select tr.[TestResultId], trh.[ChangeDate], trc.[Comment]
		from [TestResult] tr
		inner join [TestResultHistory] as trh on trh.TestResultId=tr.TestResultId
		inner join [TestResultHistoryComment] as trc on trc.TestResultHistoryId=trh.TestResultHistoryId
	) as mix		

	select mix.[TestResultId], trc.[Comment] from (
		select tr.[TestResultId], max(trh.[ChangeDate]) as [ChangeDate]
		from [TestResult] tr
		inner join [TestResultHistory] as trh on trh.TestResultId=tr.TestResultId
		inner join [TestResultHistoryComment] as trc on trc.TestResultHistoryId=trh.TestResultHistoryId
		group by tr.[TestResultId]
	) as mix
	inner join [TestResultHistory] as trh on trh.TestResultId=mix.TestResultId
	inner join [TestResultHistoryComment] as trc on trc.TestResultHistoryId=trh.TestResultHistoryId 
	where trh.[ChangeDate]=mix.[ChangeDate]
