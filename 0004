// Соберем все записи
List<STCPTContext> stcpttRows = new List<STCPTContext>()
foreach (TaskContent keyInfo in tcs)
{
    STCPTTContext stcpttRow = stcpRow.FindSTCPTT(keyInfo.ContentUid, date);
    if (stcpttRow != null)
        stcpttRows.Add(stcpttRow)
}
// Найдем все записи на добавление
List<STCPTContext> rowsToAdd = new List<STCPTContext>()

// Повторяем старую логику
foreach (STCPTContext stcpttRow in rowsToAdd)
{
    STCPTContext stcptRow = stcpRow.FindSTCPT(stcpttRow.STCPTT.STCPTUid);
    if (stcpttRow.STCPTT.TestType == (int)TestType.Group)
    {
        STCPTTContext[] cRows = stcptRow.FindChildSTCPTT(stcpttRow.STCPTT.TechTestUid);
        if (cRows != null)
            Array.ForEach(cRows, cRow => sType = AddDescriptor(tech, helper, sType, keyInfo, stcptRow, cRow, date));
    }
    else
        sType = AddDescriptor(tech, helper, sType, keyInfo, stcptRow, stcpttRow, date);
}

  

Вопросы к димону по http://tfs2012:8080/tfs/Indusoft/BMU/_workitems?id=109063&_a=edit
1) как генерируются задания? по расписанию или в ручную? какой кнопкой?
2) добавлять ли основные показатели без расписания
3) три вида настройки?

возникает вопрос кстати к постановке, а бывают основные показатели без расписания?
я бы постарался сделать так чтобы FindSTCPTT вовзращался признак и не нужно было делать запрос
в тех реализации написано что за формирование отвечает метод FindAuxTests

