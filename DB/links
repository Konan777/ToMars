http://www.lagom.nl/lcd-test/inversion.php


WITH LastApplicantLog AS (
	SELECT * FROM (
		SELECT [ApplicantId], [Date], [StageId], [ResultId],
			ROW_NUMBER() OVER (PARTITION BY [ApplicantId] ORDER BY [DateCreate] DESC, [ID] DESC) AS [RowNum] 
		FROM [client].[CrmLog] L
		WHERE ISNULL([State],'') != 'cancel'
	) AS Q
	WHERE [RowNum] = 1 
)

