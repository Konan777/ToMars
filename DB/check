	-- Проверка по дням
	SELECT COUNT (DISTINCT FB.UserId) 
	FROM [crm].[FixedBets] FB
	INNER JOIN [crm].[UserRegistrations] REG ON REG.[UserId]=FB.[UserId]
	WHERE CAST(FB.[DateTime] AS DATE)>=DATEADD(day, -30, CAST('2019-02-25' AS DATE)) 
		AND CAST(FB.[DateTime] AS DATE)<=CAST('2019-02-25' AS DATE)
		AND REG.[AtomId]=1400

	SELECT  
		COUNT(*) AS [Уникальных пользователей сделавших ставку]
		, SUM(FB.[AMOUNT]) AS [Сумма сделаных ставок за день]
	FROM [crm].[UserRegistrations] REG 
	INNER JOIN (
		SELECT DISTINCT UserId, CAST([DateTime] AS DATE) AS [DateTime], SUM([AMOUNT]) AS [AMOUNT]
		FROM [crm].[FixedBets]
		GROUP BY UserId, CAST([DateTime] AS DATE)
	) FB ON FB.UserId=REG.UserId
	WHERE REG.[SourceTable]='Registrations' 
		AND REG.AtomId=1400
		AND FB.[DateTime]=CAST('2019-02-25' AS DATE)
		
	SELECT  
		COUNT(*) AS [Уникальных пользователей с доходом]
		, SUM(FB.[ProfitValue]) AS [Доход за день]
	FROM [crm].[UserRegistrations] REG 
	INNER JOIN (
		SELECT DISTINCT UserId, CAST([DateTime] AS DATE) AS [DateTime], SUM([ProfitValue]) AS [ProfitValue]
		FROM [crm].[Profits]
		GROUP BY UserId, CAST([DateTime] AS DATE)
	) FB ON FB.UserId=REG.UserId
	WHERE REG.[SourceTable]='Registrations'
		AND REG.AtomId=1400
		AND FB.[DateTime]=CAST('2019-02-25' AS DATE)

